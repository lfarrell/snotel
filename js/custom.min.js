d3.queue().defer(d3.csv,"web_files/grouped_0.csv").defer(d3.csv,"web_files/grouped_2.csv").defer(d3.csv,"web_files/grouped_3.csv").await(function(p,h,B,r){function C(a,f,b){var c=5<b||500>m?0:10,e=5<b?w:[1,3],g=5<b?x.reverse():x,D=d3.scaleQuantile().domain(d3.extent(a,d3.f("temp_mean"))).range(g),h=d3.scaleSqrt().domain(d3.extent(a,d3.f("snow_mean"))).range(e);E(f+"-legend-temp",D);F(f+"-legend",h);var y=G(a,"date",t),e=_.pluck(_.uniq(a,function(a){return a.elev}),"elev"),z=H(e,u),e=d3.axisBottom().scale(y).tickFormat(d3.timeFormat(I)),
    g=d3.axisLeft().scale(z).tickFormat(d3.format(",d")),A=l(f).append("svg").attr("id","graph-"+b).attr("width",t+d.left+d.right).attr("height",u+d.top+d.bottom);(function(a,b,c){c=c?0:u;a.append("g").attr("class","axis x").translate([d.left,c+d.top]);d3.select(f+" g.x").call(b)})(A,e,!0);(function(a,b){a.append("g").attr("class","axis y").translate([d.left-25,d.top]);d3.select(f+" g.y").call(b)})(A,g);a=A.selectAll("circle").data(a);a.enter().append("circle").merge(a).translate([d.left-c,d.top]).style("fill",
    function(a){return D(a.temp_mean)}).attr("cx",function(a){return y(a.date)}).attr("cy",function(a){return z(a.elev)}).attr("r",function(a){return h(a.snow_mean)}).on("mouseover touchstart",function(a){n.transition().duration(100).style("opacity",.9);var c=5<b?"":" ("+L(a.date.getUTCMonth())+")";n.html('<h4 class="text-center">'+a.date.getFullYear()+c+'</h4><h5  class="text-center">Snow/Water Equivalence</h5><ul class="list-unstyled"<li>Elevation: '+a.elev+"+ feet</li><li>Temp Mean: "+a.temp_mean+
        " degrees</li><li>Water Mean: "+a.snow_mean+" inches</li><li>Water Median: "+a.snow_median+" inches</li></ul>").style("top",d3.event.pageY+18+"px").style("left",d3.event.pageX-55+"px");d3.select(this).attr("r",1.3*h(a.snow_mean))}).on("mouseout touchend",function(a){n.transition().duration(250).style("opacity",0);d3.select(this).attr("r",h(a.snow_mean))});a.exit().remove();20===b&&500<=m&&(c=[{xVal:k("2008"),yVal:3E3,path:"M112,93L89,38",text:"Max Water Levels",textOffset:[73,109]},{xVal:k("2005"),
    yVal:2E3,path:"M96,67L76,27",text:"Min Water Levels",textOffset:[63,83]},{xVal:k("2002"),yVal:1E4,path:"M35,-13L69,19",text:"Min Temp Levels",textOffset:[-7,-18]},{xVal:k("2016"),yVal:3E3,path:"M36,93L66,33",text:"Max Temp Levels",textOffset:[-3,112]}],q("#graph-"+b,c,y,z))}function G(a,d,b){b=d3.scaleTime().range([0,b]);b.domain(d3.extent(a,d3.f(d)));return b}function H(a,d){var b=d3.scaleBand().rangeRound([d,0]).padding(1);b.domain(a);return b}function q(a,d,b,c){var e=d3.swoopyDrag().x(function(a){return b(a.xVal)}).y(function(a){return c(a.yVal)}).draggable(0);
    e.annotations(d);console.log(d);l(a).append("g.annotations").call(e)}function F(a,d){var b=window.innerWidth,c,e;1E3>b?(c="vertical",e=10):(c="horizontal",e=25);var g=/el/.test(a)?30:15,f="vertical"===c?230:75,b=1E3>b?200:900,f=l(a).classed("svg",!0).attr("width",b).attr("height",f);f.append("g").attr("class","legendSize").translate([30,e]);c=d3.legendSize().scale(d).shape("circle").shapePadding(g).labelOffset(20).orient(c);f.select(".legendSize").call(c);return f}function E(a,d){var b=window.innerWidth,
    c,e;1E3>b?(c=40,e="vertical"):(c=70,e="horizontal");var g="vertical"===e?230:75,f=1E3>b?200:900,b=a.substr(1),g=l(a).classed("svg",!0).classed("legend",!0).attr("width",f).attr("height",g);g.append("g").attr("class","legend-"+b).attr("width",f).translate([0,20]);c=d3.legendColor().shapeWidth(c).orient(e).labelFormat(d3.format(".01f")).scale(d);g.select(".legend-"+b).call(c);return g}function L(a){switch(a){case 0:return"January";case 1:return"February";case 2:return"March";case 3:return"April";case 4:return"May";
    case 5:return"June";case 6:return"July";case 7:return"August";case 8:return"September";case 9:return"October";case 10:return"November";case 11:return"December";default:return"unknown"}}var d={top:25,right:40,bottom:50,left:75},x="#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" "),M=d3.timeParse("%m/%Y"),k=d3.timeParse("%Y"),u=500-d.top-d.bottom,m=window.innerWidth,I=500>=m?"%y":"%Y",t=m-100-d.right-d.left,l=d3.select;p=d3.selectAll;var n=l("body").append("div").attr("class",
    "tooltip").style("opacity",0),J={AZ:"Arizona",CA:"California",CO:"Colorado",ID:"Idaho",MT:"Montana",NV:"Nevada",NM:"New Mexico",OR:"Oregon",UT:"Utah",WA:"Washington",WY:"Wyoming"},w;w=500>m?[1,6]:[2,20];h.forEach(function(a){a.date=k(a.year);a.snow_mean=+a.snow_mean;a.temp_mean=+a.temp_mean;a.elev+="000"});B.forEach(function(a){a.date=M(a.month+"/"+a.year);a.snow_mean=+a.snow_mean;a.temp_mean=+a.temp_mean});r.forEach(function(a){a.date=k(a.year);a.snow_mean=+a.snow_mean;a.temp_mean=+a.temp_mean;a.elev+=
    "000"});C(h,"#year-month",20);C(B,"#el-year-month",5);h=_.keys(J);var K=d3.scaleQuantile().domain(d3.extent(r,d3.f("temp_mean"))).range(x),v=d3.scaleSqrt().domain(d3.extent(r,d3.f("snow_mean"))).range(w);E("#states-legend-temp",K);F("#states-legend",v);h.forEach(function(a,f){var b=r.filter(function(b){return b.state===a});l("#states").append("div").attr("class","graph").attr("id","graphed"+f);l("#graphed"+f).append("h2").attr("class","text-center text-top").text(J[a]);var c=_.pluck(_.uniq(b,"elev"),
    "elev"),e=G(b,"date",t),g=H(c,45*c.length),h=d3.axisTop().scale(e).tickFormat(d3.timeFormat(I)),p=d3.axisLeft().scale(g).tickFormat(d3.format(",d")),c=l("#graphed"+f).append("svg").attr("id",a).attr("width",t+d.left+d.right).attr("height",50*c.length);(function(a,b,c){c=c?0:u;a.append("g").attr("class","axis x").translate([d.left,c+d.top]);d3.select("#graphed"+f+" g.x").call(b)})(c,h,!0);(function(a,b){a.append("g").attr("class","axis y").translate([d.left-25,d.top]);d3.select("#graphed"+f+" g.y").call(b)})(c,
    p);b=c.selectAll("circle").data(b);b.enter().append("circle").merge(b).translate([d.left,d.top]).style("fill",function(a){return K(a.temp_mean)}).attr("cx",function(a){return e(a.date)}).attr("cy",function(a){return g(a.elev)}).attr("r",function(a){return v(a.snow_mean)}).on("mouseover touchstart",function(a){n.transition().duration(100).style("opacity",.9);n.html('<h4 class="text-center">'+a.date.getFullYear()+'</h4><h5  class="text-center">Snow/Water Equivalence</h5><ul class="list-unstyled"<li>Elevation: '+
    a.elev+"+ feet</li><li>Temp Mean: "+a.temp_mean+" degrees</li><li>Water Mean: "+a.snow_mean+" inches</li><li>Water Median: "+a.snow_median+" inches</li></ul>").style("top",d3.event.pageY+18+"px").style("left",d3.event.pageX-55+"px");d3.select(this).attr("r",1.3*v(a.snow_mean))}).on("mouseout touchend",function(a){n.transition().duration(250).style("opacity",0);d3.select(this).attr("r",v(a.snow_mean))});b.exit().remove();500<=m&&("AZ"===a&&(b=[{xVal:k("2009"),yVal:6E3,path:"M104,43L83,29",text:"Max Temp Levels",
    textOffset:[57,54]}],q("#AZ",b,e,g)),"CA"===a&&(b=[{xVal:k("2015"),yVal:5E3,path:"M97,43L77,27",text:"Min Water Levels",textOffset:[57,54]}],q("#CA",b,e,g)),"CO"===a&&(b=[{xVal:k("2002"),yVal:9E3,path:"M46,-23L69,19",text:"Min Temp Levels",textOffset:[16,-25]}],q("#CO",b,e,g)),"WA"===a&&(b=[{xVal:k("2012"),yVal:6E3,path:"M110,-5L91,13",text:"Max Water Levels",textOffset:[87,-11]}],q("#WA",b,e,g)))});h=p(".row");h.classed("opaque",!1);h.classed("hide",!1);p("#load").classed("hide",!0)});